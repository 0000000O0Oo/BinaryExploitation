# CCANARY ALLESCTF 2021
`ccanary` was a easy pwn challenge from the AllesCTF 2021, in this README we'll look deep into `vsyscall` and `PIE`

## Reading the Source
```c
// clang -o ccanary ccanary.c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

void ignore_me_init_buffering() {
    setvbuf(stdout, NULL, _IONBF, 0);
    setvbuf(stdin, NULL, _IONBF, 0);
    setvbuf(stderr, NULL, _IONBF, 0);
}

void canary(void) { puts("canary: *chirp* *chirp*"); }

struct data {
    char yourinput[32];
    void (*call_canary)();
    int give_flag;
};

// FIXME: this partial-overwrite mitigation sucks :/
void quotegets(char* inp) {
    *inp = '"';
    // read input
    for (; *inp != '\n';)
        *++inp = fgetc(stdin);
    // append postfix
    for (char* postfix = "\"\n- you, 2021"; *postfix; postfix++)
        *inp++ = *postfix;
    // NUL-terminate
    *inp = 0;
}

int main(void) {
    ignore_me_init_buffering();
    struct data data = {
        .yourinput = { 0 },
        .call_canary = canary,
        .give_flag = 0,
    };

    printf("quote> ");
    quotegets((char*) &data.yourinput);

    data.call_canary();
    puts("good birb!");

    puts("");
    puts((char*) &data.yourinput);

    if (data.give_flag) {
        puts("Here's the flag:");
        system("cat flag");
    }
    return 0;
}
```

We have a `poor man` implementation of `gets` function call using `fgetc` until a `\n` is found...
This allow us to overwrite pretty much anything on the stack, but i'm pretty sure security have been enabled, let's check it out.

## Program Securities
```bash
[*] '/home/spacek9/Documents/CTF/AllesCTF/ccanary/ccanary'
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      PIE enabled
```

Okay so we have `NX` or "Linux DEP", and we have `PIE`, now what is truly `PIE` and `NX` ?

#### PIE
PIE Stands for `Position Independent Executable`, it makes sure address are randomized everytime you run the program. It works like `ASLR` but `ASLR` is for Windows, Linux uses `PIE` and `PIC`

https://access.redhat.com/blogs/766093/posts/1975793

## Exploiting the Program
![image](https://user-images.githubusercontent.com/61102077/132337668-a1cf6be2-d2e8-4588-aa8c-126ac8c05a20.png)

`vsyscalls` shouldn't be enabled on your system by default, hence the flag saying `this might not work on your system`
